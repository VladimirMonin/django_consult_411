<!-- 
–ú–û–î–ï–õ–ò
from django.db import models

class Master(models.Model):
    first_name = models.CharField(max_length=100, verbose_name="–ò–º—è")
    last_name = models.CharField(max_length=100, verbose_name="–§–∞–º–∏–ª–∏—è")
    middle_name = models.CharField(
        null=True, blank=True, max_length=100, verbose_name="–û—Ç—á–µ—Å—Ç–≤–æ"
    )
    phone = models.CharField(
        max_length=20, verbose_name="–¢–µ–ª–µ—Ñ–æ–Ω", default="00000000000"
    )
    email = models.EmailField(null=True, blank=True, verbose_name="Email")
    services = models.ManyToManyField("Service", verbose_name="–£—Å–ª—É–≥–∏", related_name="masters")

    def __str__(self):
        return f"{self.first_name} {self.last_name}"

    class Meta:
        # –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ - –≤ –µ–¥. —á–∏—Å–ª–µ –∏ –º–Ω. —á–∏—Å–ª–µ
        verbose_name = "–ú–∞—Å—Ç–µ—Ä"
        verbose_name_plural = "–ú–∞—Å—Ç–µ—Ä–∞"
        # —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ñ–∞–º–∏–ª–∏–∏ –∏ –∏–º–µ–Ω–∏
        ordering = ["last_name", "first_name"]

class Order(models.Model):
    name = models.CharField(max_length=100, verbose_name="–ò–º—è")
    phone = models.CharField(max_length=20, verbose_name="–¢–µ–ª–µ—Ñ–æ–Ω")
    comment = models.TextField(verbose_name="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π", null=True, blank=True)
    master = models.ForeignKey(
        Master,
        verbose_name="–ú–∞—Å—Ç–µ—Ä",
        default=None,
        on_delete=models.SET_DEFAULT,
        related_name="orders",
    )
    services = models.ManyToManyField("Service", verbose_name="–£—Å–ª—É–≥–∏", related_name="orders")

class Review(models.Model):

    RATING_CHOICES = [
        (1, "–£–∂–∞—Å–Ω–æ"),
        (2, "–ü–ª–æ—Ö–æ"),
        (3, "–ù–æ—Ä–º–∞–ª—å–Ω–æ"),
        (4, "–•–æ—Ä–æ—à–æ"),
        (5, "–û—Ç–ª–∏—á–Ω–æ"),
    ]

    text = models.TextField(verbose_name="–¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞")
    client_name = models.CharField(
        max_length=100, blank=True, null=True, verbose_name="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞"
    )
    master = models.ForeignKey(
        Master, on_delete=models.SET_NULL, null=True, verbose_name="–ú–∞—Å—Ç–µ—Ä"
    )
    photo = models.ImageField(
        upload_to="reviews/", blank=True, null=True, verbose_name="–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è"
    )
    created_at = models.DateTimeField(auto_now_add=True, verbose_name="–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è")
    rating = models.PositiveSmallIntegerField(
        verbose_name="–û—Ü–µ–Ω–∫–∞", choices=RATING_CHOICES, default=5
    )
    is_published = models.BooleanField(default=False, verbose_name="–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω")

class Service(models.Model):
    name = models.CharField(max_length=200, verbose_name="–ù–∞–∑–≤–∞–Ω–∏–µ")
    description = models.TextField(blank=True, verbose_name="–û–ø–∏—Å–∞–Ω–∏–µ")
    price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="–¶–µ–Ω–∞")
    duration = models.PositiveIntegerField(
        verbose_name="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", help_text="–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö", default=20
    )
    is_popular = models.BooleanField(default=False, verbose_name="–ü–æ–ø—É–ª—è—Ä–Ω–∞—è —É—Å–ª—É–≥–∞")

    def __str__(self):
        return self.name

 -->

# –¢–µ–º–∞ Django ORM –ß4. LookUp –∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å Q. –£—Ä–æ–∫ 57

## –ß—Ç–æ —Ç–∞–∫–æ–µ LookUp? üîç

–õ—É–∫–∞–ø—ã (LookUp) ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Django ORM. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É—è —É—Å–ª–æ–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã.

–í—ã–≥–ª—è–¥—è—Ç –æ–Ω–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```python
from django.db.models import Q

```python
# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ó–∞—è–≤–æ–∫ –ø–æ –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞
orders = Order.objects.filter(master__first_name="–ê–ª–µ–≤—Ç–∏–Ω–∞")
```

`__` - –≠—Ç–æ –∏ –µ—Å—Ç—å –ª—É–∫–∞–ø.
`master__first_name` - –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –ø–æ–ª—é `first_name` –º–æ–¥–µ–ª–∏ `Master`.

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—Å—Ç—ã—Ö –ª—É–∫–∞–ø–æ–≤

–ó–∞–ø—É—Å–∫–∞–µ–º shell plus –≤ —Ä–µ–∂–∏–º–µ print_sql
`poetry run python manage.py shell_plus --print-sql`

–ë–µ–∑ –ª—É–∫–∞–ø–∞ –º—ã –º–æ–≥–ª–∏ –±—ã –Ω–∞—á–∞—Ç—å —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –∏ –≤–∑—è—Ç—å –º–∞—Å—Ç–µ—Ä–∞ –ø–æ –∏–º–µ–Ω–∏, –∏ –≤—ã—Ç—è–Ω—É—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –ø—Ä–∏–Ω—è–ª.

```python
# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ó–∞—è–≤–æ–∫ –ø–æ –∏–º–µ–Ω–∏ –º–∞—Å—Ç–µ—Ä–∞
master = Master.objects.get(first_name="–ê–ª–µ–≤—Ç–∏–Ω–∞")
orders = Order.objects.filter(master=master)

# –ò–ª–∏ –¥–∞–∂–µ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
aleftina_orders = Master.objects.get(first_name="–ê–ª–µ–≤—Ç–∏–Ω–∞").orders.all()
```

### –¢–∞–±–ª–∏—Ü–∞ –ª—É–∫–∞–ø–æ–≤ –¥–ª—è —É—Å–ª–æ–≤–∏–π –≤—ã–±–æ—Ä–∫–∏.

| Lookup      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                     | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                                             |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| exact       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.                                                 | Master.objects.filter(first_name__exact='–ê–ª–µ–≤—Ç–∏–Ω–∞')              |
| iexact      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞.                              | Master.objects.filter(first_name__iexact='–∞–ª–µ–≤—Ç–∏–Ω–∞')             |
| contains    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É.                                                          | Service.objects.filter(name__contains='—Å—Ç—Ä–∏–∂–∫–∞')                 |
| icontains   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞.                                       | Service.objects.filter(name__icontains='–°–¢–†–ò–ñ–ö–ê')                |
| in          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.                                                 | Master.objects.filter(id__in=[1, 2, 3])                         |
| gt          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –±–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.                                                            | Service.objects.filter(price__gt=1000)                          |
| gte         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é.                                                  | Service.objects.filter(price__gte=1000)                         |
| lt          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –º–µ–Ω—å—à–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.                                                            | Service.objects.filter(price__lt=1000)                          |
| lte         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –º–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é.                                                  | Service.objects.filter(price__lte=1000)                         |
| startswith  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–¥–∞–Ω–Ω–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏.                                                      | Master.objects.filter(last_name__startswith='–ò–≤')                |
| istartswith | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–¥–∞–Ω–Ω–æ–π –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞.                                   | Master.objects.filter(last_name__istartswith='–∏–≤')               |
| endswith    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É.                                                  | Master.objects.filter(last_name__endswith='–æ–≤')                  |
| iendswith   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É –±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞.                               | Master.objects.filter(last_name__iendswith='–û–í')                 |
| range       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.                                                       | Service.objects.filter(price__range=(500, 2000))                 |
| date        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –¥–∞—Ç–æ–π, —Ä–∞–≤–Ω–æ–π –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∞—Ç–µ.                                                 | Review.objects.filter(created_at__date=datetime.date(2025, 6, 1))|
| year        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –≥–æ–¥–æ–º, —Ä–∞–≤–Ω—ã–º –∑–∞–¥–∞–Ω–Ω–æ–º—É –≥–æ–¥—É.                                                | Review.objects.filter(created_at__year=2025)                     |
| month       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –º–µ—Å—è—Ü–µ–º, —Ä–∞–≤–Ω—ã–º –∑–∞–¥–∞–Ω–Ω–æ–º—É –º–µ—Å—è—Ü—É.                                            | Review.objects.filter(created_at__month=6)                       |
| day         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –¥–Ω–µ–º, —Ä–∞–≤–Ω—ã–º –∑–∞–¥–∞–Ω–Ω–æ–º—É –¥–Ω—é.                                                  | Review.objects.filter(created_at__day=1)                         |
| week_day    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è –¥–Ω–µ–º –Ω–µ–¥–µ–ª–∏, —Ä–∞–≤–Ω—ã–º –∑–∞–¥–∞–Ω–Ω–æ–º—É –¥–Ω—é –Ω–µ–¥–µ–ª–∏. (0 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) | Review.objects.filter(created_at__week_day=0)                    |
| isnull      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —è–≤–ª—è–µ—Ç—Å—è NULL –∏–ª–∏ –Ω–µ NULL.                                                            | Master.objects.filter(middle_name__isnull=True)                  |
| regex       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é.                                        | Master.objects.filter(first_name__regex=r'^[–ê-–Ø–∞-—è]+$')          |

## –ü—Ä–∞–∫—Ç–∏–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –ª—É–∫–∞–ø—ã

–õ—É–∫–∞–ø - –Ω–µ –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ Join —Ç–∞–±–ª–∏—Ü, –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–∏–º–µ—Ä–µ. –≠—Ç–æ —á–∞—Å—Ç–æ —Ç–∞–∫ –∂–µ –∏ —Ä–∞–±–æ—Ç–∞ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –≥–¥–µ –Ω–∞–º –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã SQL.

–¢–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∫–∞–∫ `IN`, `BETWEEN`, `LIKE` –∏ —Ç.–¥.

### –£—Å–ª—É–≥–∞ –≥–¥–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–∏–∂–∫–∞
```python
query1 = Service.objects.filter(name__contains='–±–æ—Ä–æ–¥')
```

–¢—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `__contains` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É.

SLQ –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ `WHERE "core_service"."name" LIKE '%—Å—Ç—Ä–∏–∂–∫–∞%'`

### –ú–∞—Å—Ç–µ—Ä–∞ –ø–æ —Å–ø–∏—Å–∫—É id

```python
query2 = Master.objects.filter(id__in=[1, 2, 3])
```

–õ—É–∫–∞–ø `__in` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π.

SQL –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ `WHERE "core_master"."id" IN (1, 2, 3)`

### –£—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–æ–π –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ–π 1000
```python
Service.objects.filter(price__gte=1000)
```

–¢—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `__gte` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é.

SQL –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ `WHERE "core_service"."price" >= '1000'`

### –£—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–æ–π –º–µ–∂–¥—É 500 –∏ 2000
```python
Service.objects.filter(price__range=(500, 2000))
```

–¢—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `__range` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.

SQL –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ `WHERE "core_service"."price" BETWEEN '500' AND '2000'`

### –ú–∞—Å—Ç–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ "—ã–π"
```python
Master.objects.filter(last_name__endswith='—ã–π')
```
–¢—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `__endswith` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ–¥—Å—Ç—Ä–æ–∫—É.

### –£—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ 2025 –≥–æ–¥—É

```python
Review.objects.filter(created_at__year=2025)
```

–¢—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `__year` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è –≥–æ–¥–æ–º, —Ä–∞–≤–Ω—ã–º –∑–∞–¥–∞–Ω–Ω–æ–º—É –≥–æ–¥—É.

SQL –∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞:
`WHERE "core_review"."created_at" BETWEEN '2025-01-01 00:00:00' AND '2025-12-31 23:59:59.999999'`

### –ó–∞–ø–∏—Å–∏ –Ω–∞ —É—Å–ª—É–≥—É –ø–æ–∑–∂–µ 2024 –≥–æ–¥–∞
```python
import datetime
Review.objects.filter(created_at__gt=datetime.date(2025, 1, 1))

# –ò–ª–∏ —á–µ—Ä–µ–∑ __year
Review.objects.filter(created_at__year__gt=2024)
```

WHERE "core_review"."created_at" > '2025-01-01 00:00:00'
WHERE "core_review"."created_at" > '2024-12-31 23:59:59.999999'

–ò–ª–∏ –æ—Ç–∑—ã–≤—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 10 —Ñ–µ–≤—Ä–∞–ª—è 2025 –≥–æ–¥–∞

```python
from datetime import datetime
cutoff_date = datetime(2025, 2, 10)
Review.objects.filter(created_at__gt=cutoff_date)
Review.objects.filter(created_at__date__gt="2025-02-10")
```

WHERE django_datetime_cast_date("core_review"."created_at", 'UTC', 'UTC') > '2025-02-10'

## –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò

–ú—ã –º–æ–∂–µ–º –≤—ã–∑–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã —Ü–µ–ø–æ—á–∫–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò.
```Python
Service.objects.filter(name__contains='–±–æ—Ä–æ–¥–∞').filter(price__gt=200)
```

–ú—ã –º–æ–∂–µ–º –≤ –æ–¥–Ω–æ–º —Ñ–∏–ª—å—Ç—Ä–µ, —É–∫–∞–∑–∞—Ç—å —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ò.
–£—Å–ª—É–≥–∞ –≥–¥–µ –µ—Å—Ç—å –±–æ—Ä–æ–¥–∞ –∏ —Ü–µ–Ω–∞ –≤—ã—à–µ 200
```python
Service.objects.filter(name__contains='–±–æ—Ä–æ–¥–∞', price__gt=200)
```

–ú—ã –º–æ–∂–µ–º –≤—ã–∑–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –∫ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É, —Ç.–µ. –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–≥–æ –∫ –∫–≤–µ—Ä–∏—Å–µ—Ç—É
```python
query = Service.objects.filter(name__contains='–±–æ—Ä–æ–¥–∞')
query = query.filter(price__gt=200)
```

## Q - –æ–±—ä–µ–∫—Ç—ã –≤ Django ORM

Q - —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ Django ORM. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å.

Q –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã AND, OR –∏ NOT.
- `()` - –æ–ø–µ—Ä–∞—Ç–æ—Ä –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- `~` - –æ–ø–µ—Ä–∞—Ç–æ—Ä NOT
- `&` - –æ–ø–µ—Ä–∞—Ç–æ—Ä AND
- `|` - –æ–ø–µ—Ä–∞—Ç–æ—Ä OR

```python
from django.db.models import Q

# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Q –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ AND
services = Service.objects.filter(
    Q(name__contains='–±–æ—Ä–æ–¥') & Q(price__gt=200)
    )

# –ú—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å Q –æ—Ç–¥–ª–µ—å–Ω–æ
q1 = Q(name__contains='–±–æ—Ä–æ–¥')
q2 = Q(price__gt=200)
services = Service.objects.filter(q1 & q2)

# –ú—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –¥–∞–∂–µ –ø—É—Å—Ç—É—é Q –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –Ω–µ–µ —É—Å–ª–æ–≤–∏—è
q = Q()
q &= Q(name__contains='–±–æ—Ä–æ–¥')
q &= Q(price__gt=200)
services = Service.objects.filter(q)
```

#TODO –ü–æ—è—Å–Ω–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º
- –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –∫–∞–∂–¥—ã–π –∏–∑ 3 –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞—Å—Å–∫–∞–∑—Ç—å –ø—Ä–æ "–∏–Ω–ø–ø–ª–µ–π—Å" –æ–ø–µ—Ä–∞—Ü–∏–∏

`&=` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ Q, –ø—Ä–∏–º–µ–Ω—è—è –æ–ø–µ—Ä–∞—Ç–æ—Ä AND.
`|=` - —ç—Ç–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ Q, –ø—Ä–∏–º–µ–Ω—è—è –æ–ø–µ—Ä–∞—Ç–æ—Ä OR.
#TODO - –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å NOT?

### –ü—Ä–∞–∫—Ç–∏–∫–∞
–° –∏—Å–ø–æ–ª—å–æ–≤–∞–Ω–∏–µ–º Q
1. –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ —É –∫–æ—Ç–æ—Ä—ã—Ö –∏–º—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–∞ –±—É–∫–≤—É –ê –∏–ª–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –±—É–∫–≤—É –∞
2. –•–æ—Ä–æ—à–∏–µ –æ—Ç–∑—ã–≤—ã –Ω–∞ –ê–ª–µ–≤—Ç–∏–Ω—É. –û—Ç–∑—ã–≤ —Å –æ—Ü–µ–Ω–∫–æ–π –±–æ–ª—å—à–µ 3 –∏ –∏–º—è –º–∞—Å—Ç–µ—Ä–∞ == –ê–ª–µ–≤—Ç–∏–Ω–∞
3. –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –ò–º—è –Ω–∞—á–Ω–∏–∞–µ—Ç—Å—è –Ω–∞ –±—É–∫–≤—É –ê –∏ –º–∞—Å—Ç–µ—Ä –æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–æ–ª—å—à–µ 1 —É—Å–ª—É–≥–∏ (—Ç—É—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `count` —É QuerySet)


```python
# 1.
from django.db.models import Q
a_masters = Master.objects.filter(
    Q(first_name__startswith='–ê') | ...
)

# 2.
q_mark = Q(rating__gte=3)
q_name = Q(...)
good_reviews = Review.objects.filter(q_mark & ...)


# 3. –ü–ª–æ—Ö–æ–µ —Ä–µ—à–µ–Ω–∏–µ
# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ —Å –∏–º–µ–Ω–∞–º–∏ –Ω–∞ "–ê"
masters_starting_with_A = Master.objects.filter(first_name__startswith='–ê')

# –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–∞—Å—Ç–µ—Ä–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ 1 —É—Å–ª—É–≥–∏
result = [master for master in masters_starting_with_A if master.services.count() > 1]

# 3. –•–æ—Ä–æ—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ
# –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Ç–µ—Ä–æ–≤ —Å –∏–º–µ–Ω–∞–º–∏ –Ω–∞ "–ê" –∏ –±–æ–ª–µ–µ —á–µ–º –æ–¥–Ω–æ–π —É—Å–ª—É–≥–æ–π
result = Master.objects.filter(
    first_name__startswith='–ê'
).annotate(
    service_count=Count('services')
).filter(
    service_count__gt=1
)