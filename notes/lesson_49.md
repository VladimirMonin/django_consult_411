## Отладчик VS Code

![Отладка Django в VS Code](./images/debug_vs_code.png)

```json
{
    "version": "0.2.0",
    "configurations": [
      {
        "name": "Django: Отладка представлений",    // Имя конфигурации, отображаемое в меню запуска
        "type": "debugpy",                          // Тип отладчика (debugpy для Python)
        "request": "launch",                        // Тип запроса - запуск нового процесса
        "program": "${workspaceFolder}/manage.py",  // Путь к файлу manage.py
        "args": ["runserver", "--noreload"],        // Аргументы команды (--noreload отключает автоперезагрузку)
        "django": true,                             // Активирует специфичную для Django отладку
        "justMyCode": false,                        // Позволяет отлаживать код библиотек
        "console": "integratedTerminal",            // Использовать встроенный терминал VS Code
        "env": {
          "PYTHONPATH": "${workspaceFolder}"        // Установка переменной окружения PYTHONPATH
        }
      }
    ]
  }
```

## Необходимые расширения VS Code

Для эффективной отладки Django проектов в VS Code вам потребуются следующие расширения:

1. **Python** (издатель: Microsoft) - основное расширение для работы с Python
2. **Python Debugger** (издатель: Microsoft) - расширение для отладки Python кода
3. **Django** (издатель: Baptiste Darthenay) - опционально, предоставляет подсветку синтаксиса в шаблонах Django

## Настройка отладки

### Шаг 1: Создание конфигурации отладки

Если файл `.vscode/launch.json` еще не создан в вашем проекте, вы можете создать его следующим образом:

1. Нажмите `Ctrl+Shift+D` для перехода в режим отладки
2. Нажмите на ссылку "создать файл launch.json" или кнопку с шестеренкой и выберите "Добавить конфигурацию..."
3. Выберите "Python"
4. Выберите "Django"

### Шаг 2: Выбор правильного интерпретатора Python

1. Нажмите `Ctrl+Shift+P`, чтобы открыть палитру команд
2. Введите "Python: Select Interpreter" и выберите интерпретатор из вашего виртуального окружения

### Шаг 3: Установка необходимых пакетов

```powershell
# Установка debugpy, если он еще не установлен
poetry add --dev debugpy
```

## Использование отладчика

1. **Установка точек останова (breakpoints)**
   - Щелкните левее номера строки в редакторе кода, появится красная точка
   - Или нажмите F9 на выбранной строке

2. **Запуск отладчика**
   - Нажмите F5 или зеленую кнопку "▶" в панели отладки
   - Выберите конфигурацию "Django: Отладка представлений"

3. **Управление процессом отладки**
   - F5 - продолжить выполнение
   - F10 - шаг с обходом (step over)
   - F11 - шаг с заходом (step into)
   - Shift+F11 - шаг с выходом (step out)
   - Shift+F5 - остановить отладку

## Решение типичных проблем

### Ошибка "ImportError: Couldn't import Django"

Эта ошибка возникает, когда Django не установлен или не найден в PYTHONPATH.

**Решения:**

1. Убедитесь, что виртуальное окружение активировано
2. Проверьте, что Django установлен: `pip list | findstr django`
3. Установите Django, если его нет: `poetry add django`
4. Проверьте, что VS Code использует правильный интерпретатор из вашего виртуального окружения

### Проблемы с путями, содержащими кириллицу

Если ваш проект находится в папке с кириллическими символами, могут возникать проблемы с отладкой.

**Решения:**

1. По возможности, переместите проект в путь без кириллицы
2. Явно укажите полный путь к проекту в PYTHONPATH в файле launch.json
3. Используйте короткие имена Windows (формат 8.3) для путей с кириллицей

## Советы по эффективной отладке

1. **Условные точки останова**
   - Щелкните правой кнопкой на точке останова
   - Выберите "Edit Breakpoint" и добавьте условие

2. **Просмотр переменных**
   - Наведите курсор на переменную во время отладки
   - Используйте панель "ПЕРЕМЕННЫЕ" для просмотра всех доступных переменных
   - Добавляйте выражения для отслеживания в панели "КОНТРОЛЬНЫЕ ЗНАЧЕНИЯ"

3. **Отладка шаблонов**
   - Для отладки в шаблонах используйте тег {% debug %} (требуется добавить 'django.template.context_processors.debug' в TEMPLATES в settings.py)
   - Установка точек останова в представлениях перед вызовом render()

4. **Использование Python Debugger (pdb)**
   - Добавьте строку `import pdb; pdb.set_trace()` в код для программной точки останова
   - В Python 3.7+ можно использовать `breakpoint()` для той же цели

## Django Plugin

Расширение Django (автор: Baptiste Darthenay) предоставляет дополнительные возможности при работе с проектами Django в VS Code:

- Подсветка синтаксиса в шаблонах Django (*.html,*.djhtml)
- Автодополнение тегов и фильтров Django
- Улучшенная навигация по шаблонам
- Подсветка синтаксиса в файлах settings.py, urls.py и других файлах Django

### Установка плагина

Для установки расширения Django необходимо:

1. Откройте панель расширений (Ctrl+Shift+X)
2. Введите "Django" в поиске
3. Найдите расширение от Baptiste Darthenay
4. Нажмите кнопку "Установить"

![Установка плагина Django](./images/django_plugin.png)

### Настройка расширения

После установки расширения рекомендуется настроить его для оптимальной работы. Для этого:

1. Откройте настройки VS Code (Ctrl+,)
2. В правом верхнем углу нажмите на иконку с тремя точками и выберите `Open Settings (JSON)`
3. Добавьте следующие настройки для улучшения работы с шаблонами Django:

```json
"[django-html]": {
    "breadcrumbs.showClasses": true,         // Отображение классов в панели навигации
    "editor.formatOnSave": false,            // Отключение автоформатирования при сохранении
    "editor.quickSuggestions": {             // Включение быстрых подсказок в шаблонах
        "other": true,                       // Для обычного текста
        "comments": true,                    // Для комментариев
        "strings": true                      // Для строк (важно для шаблонов)
    }
}
```

Эти настройки позволяют:

- Видеть структуру шаблона в панели хлебных крошек
- Отключить автоматическое форматирование, которое может испортить шаблоны Django
- Включить подсказки во всех контекстах шаблона, включая строки и комментарии

4. Для улучшения автодополнения и анализа кода Django добавьте следующие настройки:

```json
"python.analysis.packageIndexDepths": [
    {
        "name": "django",                   // Пакет Django
        "depth": 3,                         // Глубина анализа (3 уровня вложенности)
        "includeAllSymbols": true           // Включить все символы для анализа
    },
    {
        "name": "selenium",                 // Для тестирования веб-интерфейса
        "depth": 3,
        "includeAllSymbols": true
    },
    {
        "name": "sqlalchemy",               // Для работы с ORM (если используется)
        "depth": 3,
        "includeAllSymbols": true
    },
    {
        "name": "sqlite3",                  // Для работы с базой данных
        "depth": 3,
        "includeAllSymbols": true
    }
]
```

Эти настройки улучшают работу IntelliSense (автодополнение и подсказки) в VS Code:

- Увеличивают глубину анализа популярных пакетов до 3 уровней вложенности
- Включают все символы этих пакетов для автодополнения
- Значительно улучшают подсказки при работе с Django моделями, формами и ORM

### Базовые настройки Emmet для Django
```json
"emmet.includeLanguages": {
  "django-html": "html"
}
```
Активирует поддержку Emmet в шаблонах Django, позволяя использовать сокращения HTML.

Но можно дать расширенные настройки Emmet для Django-шаблонов, чтобы улучшить работу с HTML и Django-тегами.
```json
"emmet.triggerExpansionOnTab": true,
"emmet.showSuggestionsAsSnippets": true,
"emmet.showExpandedAbbreviation": "always",
"emmet.useInlineCompletions": true,
"emmet.extensionsPath": [],
"emmet.syntaxProfiles": {
  "html": {
    "filters.commentAfter": "<!-- /{[#]}/ -->",
    "attributes": {
      "class": "class",
      "id": "id",
      "for": "for"
    }
  },
  "django-html": {
    "filters.commentAfter": "{# /{[#]}/ #}"
  }
}
```
Особенно важны:

`emmet.triggerExpansionOnTab: true` - позволяет разворачивать аббревиатуры Emmet нажатием Tab
`emmet.syntaxProfiles` - настраивает Emmet для работы с Django-специфичными конструкциями, например комментарии в формате {# комментарий #}

### Преимущества расширения Django

1. **Улучшенная работа с шаблонами**:
   - Подсветка тегов и фильтров Django в HTML-файлах
   - Автоматическое закрытие тегов Django ({% %})
   - Автодополнение встроенных тегов и фильтров

2. **Улучшенная навигация в проекте**:
   - Переход к определению шаблонов из представлений
   - Просмотр структуры шаблонов в панели навигации
   - Структурированное отображение блоков в шаблонах

3. **Дополнительные сниппеты**:
   - Быстрое создание представлений, URL-маршрутов и моделей
   - Шаблоны для часто используемых конструкций Django

4. **Интеграция с другими расширениями**:
   - Работает совместно с расширением Python
   - Дополняет функционал отладчика для Django-проектов

Использование расширения Django значительно повышает удобство разработки проектов на Django в VS Code и ускоряет процесс написания кода.
